# Result Format

This document describes the structure of test results generated by Perfornium.

## TestResult

Each individual request/action generates a `TestResult` object.

### Core Fields

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Unique identifier for this result |
| `vu_id` | number | Virtual user ID that generated this result |
| `iteration` | number | Iteration number for this VU |
| `scenario` | string | Name of the scenario being executed |
| `name` | string | Name of the action/request |
| `action` | string | Type of action performed |
| `step_name` | string | Specific step name for detailed tracking |
| `thread_name` | string | JMeter-style thread name (e.g., "7. Protected API 1-1") |
| `timestamp` | number | Unix timestamp (ms) when the request started |
| `sample_start` | number | Request start timestamp |
| `duration` | number | Total request duration in milliseconds |
| `response_time` | number | Response time in milliseconds |
| `success` | boolean | Whether the request succeeded |

### Response Details

| Field | Type | Description |
|-------|------|-------------|
| `status` | number | HTTP status code |
| `status_text` | string | HTTP status text |
| `error` | string | Error message if request failed |
| `error_code` | string | Error code for categorization |
| `response_size` | number | Total response size in bytes |
| `response_headers` | object | Response headers |
| `response_body` | string | Response body (if captured) |

### Request Details

| Field | Type | Description |
|-------|------|-------------|
| `request_url` | string | Full request URL |
| `request_method` | string | HTTP method used |
| `request_headers` | object | Request headers |
| `request_body` | string | Request body (if captured) |

### Timing Breakdown (JMeter-style)

| Field | Type | Description |
|-------|------|-------------|
| `connect_time` | number | Time to establish TCP connection (ms) |
| `latency` | number | Time to first byte / TTFB (ms) |

### Size Breakdown (JMeter-style)

| Field | Type | Description |
|-------|------|-------------|
| `sent_bytes` | number | Total bytes sent (headers + body) |
| `headers_size_sent` | number | Request headers size in bytes |
| `body_size_sent` | number | Request body size in bytes |
| `headers_size_received` | number | Response headers size in bytes |
| `body_size_received` | number | Response body size in bytes |
| `data_type` | string | Response data type: 'text', 'bin', or '' |

### Custom Data

| Field | Type | Description |
|-------|------|-------------|
| `custom_metrics` | object | Custom metrics added via scripts |

### Example

```json
{
  "id": "vu1-1704067200123",
  "vu_id": 1,
  "iteration": 5,
  "scenario": "User Login",
  "step_name": "POST /api/login",
  "thread_name": "1. User Login 1-5",
  "timestamp": 1704067200123,
  "sample_start": 1704067200123,
  "duration": 245,
  "response_time": 245,
  "success": true,
  "status": 200,
  "status_text": "OK",
  "request_url": "https://api.example.com/api/login",
  "request_method": "POST",
  "request_headers": {
    "Content-Type": "application/json",
    "User-Agent": "Perfornium/1.0.0"
  },
  "response_headers": {
    "Content-Type": "application/json",
    "Set-Cookie": "session=abc123"
  },
  "connect_time": 45,
  "latency": 180,
  "sent_bytes": 256,
  "headers_size_sent": 180,
  "body_size_sent": 76,
  "headers_size_received": 320,
  "body_size_received": 1024,
  "data_type": "text"
}
```

## StepStatistics

Aggregated statistics for each step in a scenario.

| Field | Type | Description |
|-------|------|-------------|
| `step_name` | string | Name of the step |
| `scenario` | string | Parent scenario name |
| `total_requests` | number | Total number of requests |
| `successful_requests` | number | Number of successful requests |
| `failed_requests` | number | Number of failed requests |
| `success_rate` | number | Success rate (0-1) |
| `avg_response_time` | number | Average response time (ms) |
| `min_response_time` | number | Minimum response time (ms) |
| `max_response_time` | number | Maximum response time (ms) |
| `percentiles` | object | Response time percentiles |
| `response_times` | array | All recorded response times |
| `error_distribution` | object | Count of errors by type |
| `status_distribution` | object | Count of responses by status code |

### Example

```json
{
  "step_name": "POST /api/login",
  "scenario": "User Login",
  "total_requests": 1000,
  "successful_requests": 985,
  "failed_requests": 15,
  "success_rate": 0.985,
  "avg_response_time": 156.7,
  "min_response_time": 45,
  "max_response_time": 2340,
  "percentiles": {
    "50": 120,
    "90": 280,
    "95": 450,
    "99": 1200
  },
  "error_distribution": {
    "timeout": 10,
    "connection_refused": 5
  },
  "status_distribution": {
    "200": 985,
    "500": 10,
    "503": 5
  }
}
```

## TestSummary

Overall test execution summary.

| Field | Type | Description |
|-------|------|-------------|
| `total_requests` | number | Total requests made |
| `successful_requests` | number | Successful requests |
| `failed_requests` | number | Failed requests |
| `success_rate` | number | Overall success rate (0-1) |
| `avg_response_time` | number | Average response time (ms) |
| `min_response_time` | number | Minimum response time (ms) |
| `max_response_time` | number | Maximum response time (ms) |
| `percentiles` | object | Response time percentiles |
| `requests_per_second` | number | Average throughput |
| `bytes_per_second` | number | Data throughput |
| `bytes_received` | number | Total bytes received |
| `total_duration` | number | Test duration (ms) |
| `error_distribution` | object | Errors grouped by type |
| `status_distribution` | object | Responses grouped by status |
| `error_details` | array | Detailed error information |

### Example

```json
{
  "total_requests": 50000,
  "successful_requests": 49250,
  "failed_requests": 750,
  "success_rate": 0.985,
  "avg_response_time": 178.5,
  "min_response_time": 23,
  "max_response_time": 5420,
  "percentiles": {
    "50": 145,
    "90": 320,
    "95": 520,
    "99": 1850
  },
  "requests_per_second": 166.7,
  "bytes_per_second": 2456000,
  "bytes_received": 147360000,
  "total_duration": 300000,
  "status_distribution": {
    "200": 48500,
    "201": 750,
    "400": 200,
    "500": 450,
    "503": 100
  },
  "error_details": [
    {
      "timestamp": 1704067500000,
      "vu_id": 15,
      "scenario": "User Login",
      "action": "POST /api/login",
      "status": 500,
      "error": "Internal Server Error",
      "request_url": "https://api.example.com/api/login",
      "count": 450
    }
  ]
}
```

## ErrorDetail

Detailed information about errors encountered during testing.

| Field | Type | Description |
|-------|------|-------------|
| `timestamp` | number | When the error occurred |
| `vu_id` | number | Virtual user that encountered the error |
| `scenario` | string | Scenario where error occurred |
| `action` | string | Action that caused the error |
| `status` | number | HTTP status code (if applicable) |
| `error` | string | Error message |
| `request_url` | string | URL of the failed request |
| `response_body` | string | Response body (if available) |
| `count` | number | Number of times this error occurred |

## TimelineData

Point-in-time metrics for timeline visualization.

| Field | Type | Description |
|-------|------|-------------|
| `timestamp` | number | Unix timestamp |
| `time_label` | string | Human-readable time label |
| `active_vus` | number | Number of active virtual users |
| `requests_count` | number | Requests in this time window |
| `avg_response_time` | number | Average response time (ms) |
| `success_rate` | number | Success rate (0-1) |
| `throughput` | number | Requests per second |

### Example

```json
{
  "timestamp": 1704067260000,
  "time_label": "00:01:00",
  "active_vus": 25,
  "requests_count": 450,
  "avg_response_time": 165,
  "success_rate": 0.99,
  "throughput": 7.5
}
```

## VUStartEvent

Records when virtual users start during ramp-up.

| Field | Type | Description |
|-------|------|-------------|
| `vu_id` | number | Virtual user ID |
| `start_time` | number | Start timestamp |
| `load_pattern` | string | Load pattern being used |

### Example

```json
{
  "vu_id": 15,
  "start_time": 1704067230000,
  "load_pattern": "stepping"
}
```

## Full Results File Structure

When using JSON output, the complete results file contains:

```json
{
  "test_name": "My Performance Test",
  "start_time": "2024-01-01T00:00:00.000Z",
  "end_time": "2024-01-01T00:05:00.000Z",
  "config": {
    "load_pattern": "stepping",
    "max_vus": 100,
    "duration": 300000
  },
  "summary": { /* TestSummary object */ },
  "results": [ /* Array of TestResult objects */ ],
  "step_statistics": [ /* Array of StepStatistics objects */ ],
  "timeline_data": [ /* Array of TimelineData objects */ ],
  "vu_ramp_up": [ /* Array of VUStartEvent objects */ ],
  "errors": [ /* Array of ErrorDetail objects */ ]
}
```
